<p>The <code>run-tests.sh</code> script is called by various testers to do the work of testing. Each test is actually fairly simple: it is a comparison of standard output and standard error, as per the program specification.</p>
<p>In any given program specification directory, there exists a specific <code>tests/</code> directory which holds the expected return code, standard output, and standard error in files called <code>n.rc</code>, <code>n.out</code>, and <code>n.err</code> (respectively) for each test <code>n</code>. The testing framework just starts at <code>1</code> and keeps incrementing tests until it can't find any more or encounters a failure. Thus, adding new tests is easy; just add the relevant files to the tests directory at the lowest available number.</p>
<p>The files needed to describe a test number <code>n</code> are: - <code>n.rc</code>: The return code the program should return (usually 0 or 1) - <code>n.out</code>: The standard output expected from the test - <code>n.err</code>: The standard error expected from the test - <code>n.run</code>: How to run the test (which arguments it needs, etc.) - <code>n.desc</code>: A short text description of the test - <code>n.pre</code> (optional): Code to run before the test, to set something up - <code>n.post</code> (optional): Code to run after the test, to clean something up</p>
<p>There is also a single file called <code>pre</code> which gets run once at the beginning of testing; this is often used to do a more complex build of a code base, for example. To prevent repeated time-wasting pre-test activity, suppress this with the <code>-s</code> flag (as described below).</p>
<p>In most cases, a wrapper script is used to call <code>run-tests.sh</code> to do the necessary work.</p>
<p>The options for <code>run-tests.sh</code> include: * <code>-h</code> (the help message) * <code>-v</code> (verbose: print what each test is doing) * <code>-t n</code> (run only test <code>n</code>) * <code>-c</code> (continue even after a test fails) * <code>-d</code> (run tests not from <code>tests/</code> directory but from this directory instead) * <code>-s</code> (suppress running the one-time set of commands in <code>pre</code> file)</p>
<p>There is also another script used in testing of <code>xv6</code> projects, called <code>run-xv6-command.exp</code>. This is an <a href="https://en.wikipedia.org/wiki/Expect"><code>expect</code></a> script which launches the qemu emulator and runs the relevant testing command in the xv6 environment before automatically terminating the test. It is used by the <code>run-tests.sh</code> script as described above and thus not generally called by users directly.</p>
